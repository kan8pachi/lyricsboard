# 歌詞データの定義方法

ここで記述しているフォーマットやファイルの場所などの定義方法は、将来変更する可能性があります。
変更されて読めなくなってしまっても泣かないでください。

## 歌詞データを記載するフォーマット

LyricsBoardは、LRCフォーマットと呼ばれるテキストで定義された歌詞データを読み込むことができます。

LRCフォーマットは、多くの方言があり、そのすべてに対応することはできません。
主に、以下のようなスタイルで記述されたLRCファイルを読み込むことができます。

### `time tagged lyrics` スタイル

行頭にタイムタグを記載し、続けて歌詞をその行に記述するスタイルです。

```
[00:13.70]すきすきチュッチュ
[00:16.65]ラブビーム
```

- タイムタグは行頭に記述します。
  - 曲開始時点からの(分)・(秒)・(1/100秒)を表します。
  - `[]`で囲んでください。
  - 区切りは`:`を使います。(秒)と(1/100秒)の間は`.`でも良いです。
  - 2桁に満たない数字になる場合は、0埋めします。
  - 時刻が一律ずれている場合は、全行まとめてオフセットさせる機能があります。後述します。
- 続けて、歌詞文を記述します。
  - 時刻との間にスペースは要りません。

### `karaoke tagged lyrics` スタイル

```
[00:02:96]3[00:03:36].[00:03:76]1[00:04:16]4[00:04:56]1[00:04:96]5[00:05:36]9[00:05:76]2
[00:06:16]6[00:06:56]5[00:06:96]3[00:07:36]5[00:07:76]8[00:08:16]9[00:08:56]7[00:08:96]9
```

- 表記は、`time tagged lyrics`と同じです。
- 行頭に加えて、文中にもタイムタグを記述できます。

## ファイル

### 格納場所

歌詞データを定義したファイルは、このフォルダに格納します。 `\steamapps\common\Beat Saber\UserData\LyricsBoard\lyrics`
このフォルダは、Beat Saber起動時に存在しなければ、自動で作られますので、modインストール後には一度起動しておくと良いです。
この下に任意の数のサブフォルダを掘ることができます。
`CustomLevels`と同じフォルダ名にすると管理しやすいです。

歌詞データは、以下のいずれかの方法で格納すると、LyricsBoardが認識することができます。

- LRCデータを定義したファイルのみを、単独で置く。
  - LRCデータのファイル名 `<song-hash>.lrc`

- LRCデータを定義したファイルのほかに、メタデータ(後述)を定義したファイルをセットで置く。
  - LRCデータのファイル名 `<song-hash>.lrc`
  - メタデータのファイル名 `<song-hash>.json`

いずれも、エンコーディングは `UTF-8` 、改行コードは `LF` もしくは `CR+LF` としてください。

### 曲の識別について

現時点でのLyricsBoardは、曲の認識には `Song Hash` を使用します。
ただし、多くの方は曲を `BSR` で認識しているようで、どの曲の `Song Hash` がどれなのかが非常にわかりづらいようです。
そのため、この仕様は近いうちに変更になる可能性があります。

### メタデータ

歌詞データを定義したLRCファイルを作る場合は、基本的にはLRCファイルを単体で使用するのがおすすめです。
歌詞データの表示方法を曲ごとに補正したい場合には、LRCファイルに加えてメタデータファイルを置くことで、補正内容を定義することができます。

メタデータはJSONフォーマットで定義します。

```
{
  "OffsetMs": "1200",
  ...
}
```

以下のような項目を設定することができます。
デフォルトから変更する意図がないときは、項目を書かないでください。

- `OffsetMs` : LRCファイル内のタイムタグに、一律このオフセット(ms)を加えます。既に別の用途のLRCファイルを持っているが、ゲーム内のマップで使用されている曲の先頭には無音が挿入されているなどして時刻がずれるときに使用してください。
- `MaxExpirationMs` : 歌詞の行は、デフォルトで10000ms以内の表示時間ののちに消えます。スローテンポな曲などで短すぎる場合に、使ってください。
- `AnimationDurationMs` : 歌詞が表示されるときと消えるときのアニメーション速度を設定します。
- `StandbyDurationMs` : 歌詞の次の行が表示されるのは、デフォルトで1500ms前です。これを変更したいときに設定します。

### LRCファイルの作成

LRCファイルは、ただのテキストデータなので、お好きなテキストエディタでも作成することができます。
しかし `time tagged` も `karaoke tagged` も手打ちで作成するのはつらいので、LRCファイルを作成する専用エディタを探してみることをおすすめします。
